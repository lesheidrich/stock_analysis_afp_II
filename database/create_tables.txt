CREATE DATABASE afp_II;

DROP TABLE IF EXISTS ticker_metrics;

CREATE TABLE ticker_metrics (
    ticker_id INT AUTO_INCREMENT PRIMARY KEY,
    addTotalDebt BIGINT NOT NULL,
    address VARCHAR(255) NOT NULL,
    assetTurnoverTTM FLOAT NOT NULL,
    averageInventoryTTM BIGINT NOT NULL,
    averagePayablesTTM BIGINT NOT NULL,
    averageReceivablesTTM BIGINT NOT NULL,
    beta FLOAT NOT NULL,
    bookValuePerShareTTM FLOAT NOT NULL,
    capexPerShareTTM FLOAT NOT NULL,
    capexToDepreciationTTM FLOAT NOT NULL,
    capexToOperatingCashFlowTTM FLOAT NOT NULL,
    capexToRevenueTTM FLOAT NOT NULL,
    capitalExpenditureCoverageRatioTTM FLOAT NOT NULL,
    cashConversionCycleTTM FLOAT NOT NULL,
    cashFlowCoverageRatiosTTM FLOAT NOT NULL,
    cashFlowToDebtRatioTTM FLOAT NOT NULL,
    cashPerShareTTM FLOAT NOT NULL,
    cashRatioTTM FLOAT NOT NULL,
    ceo VARCHAR(255) NOT NULL,
    changes FLOAT NOT NULL,
    cik VARCHAR(255) NOT NULL,
    city VARCHAR(255) NOT NULL,
    companyEquityMultiplierTTM FLOAT NOT NULL,
    companyName VARCHAR(255) NOT NULL,
    country VARCHAR(255) NOT NULL,
    currency VARCHAR(255) NOT NULL,
    currentRatioTTM FLOAT NOT NULL,
    cusip VARCHAR(255) NOT NULL,
    date DATE NOT NULL,
    daysOfInventoryOnHandTTM FLOAT NOT NULL,
    daysOfInventoryOutstandingTTM FLOAT NOT NULL,
    daysOfPayablesOutstandingTTM FLOAT NOT NULL,
    daysOfSalesOutstandingTTM FLOAT NOT NULL,
    daysPayablesOutstandingTTM FLOAT NOT NULL,
    daysSalesOutstandingTTM FLOAT NOT NULL,
    dcf FLOAT NOT NULL,
    dcfDiff FLOAT NOT NULL,
    debtEquityRatioTTM FLOAT NOT NULL,
    debtRatioTTM FLOAT NOT NULL,
    debtToAssetsTTM FLOAT NOT NULL,
    debtToEquityTTM FLOAT NOT NULL,
    debtToMarketCapTTM FLOAT NOT NULL,
    defaultImage BOOLEAN NOT NULL,
    description TEXT NOT NULL, 
    dividendPaidAndCapexCoverageRatioTTM FLOAT NOT NULL,
    dividendPerShareTTM FLOAT NOT NULL,
    dividendYielPercentageTTM FLOAT NOT NULL,
    dividendYielTTM FLOAT NOT NULL,
    dividendYieldPercentageTTM FLOAT NOT NULL,
    dividendYieldTTM FLOAT NOT NULL,
    earningsYieldTTM FLOAT NOT NULL,
    ebitPerRevenueTTM FLOAT NOT NULL,
    ebtPerEbitTTM FLOAT NOT NULL,
    effectiveTaxRateTTM FLOAT NOT NULL,
    enterpriseValue BIGINT NOT NULL,
    enterpriseValueMultipleTTM FLOAT NOT NULL,
    enterpriseValueOverEBITDATTM FLOAT NOT NULL,
    enterpriseValueTTM BIGINT NOT NULL,
    evToFreeCashFlowTTM FLOAT NOT NULL,
    evToOperatingCashFlowTTM FLOAT NOT NULL,
    evToSalesTTM FLOAT NOT NULL,
    exchange VARCHAR(255) NOT NULL,
    exchangeShortName VARCHAR(255) NOT NULL,
    fixedAssetTurnoverTTM FLOAT NOT NULL,
    freeCashFlowOperatingCashFlowRatioTTM FLOAT NOT NULL,
    freeCashFlowPerShareTTM FLOAT NOT NULL,
    freeCashFlowYieldTTM FLOAT NOT NULL,
    fullTimeEmployees VARCHAR(255) NOT NULL,
    grahamNetNetTTM FLOAT NOT NULL,
    grahamNumberTTM FLOAT NOT NULL,
    grossProfitMarginTTM FLOAT NOT NULL,
    image VARCHAR(255) NOT NULL,
    incomeQualityTTM FLOAT NOT NULL,
    industry VARCHAR(255) NOT NULL,
    intangiblesToTotalAssetsTTM FLOAT NOT NULL,
    interestCoverageTTM FLOAT NOT NULL,
    interestDebtPerShareTTM FLOAT NOT NULL,
    inventoryTurnoverTTM FLOAT NOT NULL,
    investedCapitalTTM FLOAT NOT NULL,
    ipoDate VARCHAR(255) NOT NULL,
    isActivelyTrading BOOLEAN NOT NULL,
    isAdr BOOLEAN NOT NULL,
    isEtf BOOLEAN NOT NULL,
    isFund BOOLEAN NOT NULL,
    isin VARCHAR(255) NOT NULL,
    lastDiv FLOAT NOT NULL,
    longTermDebtToCapitalizationTTM FLOAT NOT NULL,
    marketCapTTM BIGINT NOT NULL,
    marketCapitalization BIGINT NOT NULL,
    minusCashAndCashEquivalents BIGINT NOT NULL,
    mktCap BIGINT NOT NULL,
    netCurrentAssetValueTTM FLOAT NOT NULL,
    netDebtToEBITDATTM FLOAT NOT NULL,
    netIncomePerEBTTTM FLOAT NOT NULL,
    netIncomePerShareTTM FLOAT NOT NULL,
    netProfitMarginTTM FLOAT NOT NULL,
    numberOfShares BIGINT NOT NULL,
    operatingCashFlowPerShareTTM FLOAT NOT NULL,
    operatingCashFlowSalesRatioTTM FLOAT NOT NULL,
    operatingCycleTTM FLOAT NOT NULL,
    operatingProfitMarginTTM FLOAT NOT NULL,
    payablesTurnoverTTM FLOAT NOT NULL,
    payoutRatioTTM FLOAT NOT NULL,
    pbRatioTTM FLOAT NOT NULL,
    peRatioTTM FLOAT NOT NULL,
    pegRatioTTM FLOAT NOT NULL,
    pfcfRatioTTM FLOAT NOT NULL,
    phone VARCHAR(255) NOT NULL,
    pocfratioTTM FLOAT NOT NULL,
    pretaxProfitMarginTTM FLOAT NOT NULL,
    price FLOAT NOT NULL,
    priceBookValueRatioTTM FLOAT NOT NULL,
    priceCashFlowRatioTTM FLOAT NOT NULL,
    priceEarningsRatioTTM FLOAT NOT NULL,
    priceEarningsToGrowthRatioTTM FLOAT NOT NULL,
    priceFairValueTTM FLOAT NOT NULL,
    priceSalesRatioTTM FLOAT NOT NULL,
    priceToBookRatioTTM FLOAT NOT NULL,
    priceToFreeCashFlowsRatioTTM FLOAT NOT NULL,
    priceToOperatingCashFlowsRatioTTM FLOAT NOT NULL,
    priceToSalesRatioTTM FLOAT NOT NULL,
    ptbRatioTTM FLOAT NOT NULL,
    quickRatioTTM FLOAT NOT NULL,
    ticker_range VARCHAR(255) NOT NULL,
    rating VARCHAR(255) NOT NULL,
    ratingDetailsDCFRecommendation VARCHAR(255) NOT NULL,
    ratingDetailsDCFScore INT NOT NULL,
    ratingDetailsDERecommendation VARCHAR(255) NOT NULL,
    ratingDetailsDEScore INT NOT NULL,
    ratingDetailsPBRecommendation VARCHAR(255) NOT NULL,
    ratingDetailsPBScore INT NOT NULL,
    ratingDetailsPERecommendation VARCHAR(255) NOT NULL,
    ratingDetailsPEScore INT NOT NULL,
    ratingDetailsROARecommendation VARCHAR(255) NOT NULL,
    ratingDetailsROAScore INT NOT NULL,
    ratingDetailsROERecommendation VARCHAR(255) NOT NULL,
    ratingDetailsROEScore INT NOT NULL,
    ratingRecommendation VARCHAR(255) NOT NULL,
    ratingScore INT NOT NULL,
    receivablesTurnoverTTM FLOAT NOT NULL,
    researchAndDevelopementToRevenueTTM FLOAT NOT NULL,
    returnOnAssetsTTM FLOAT NOT NULL,
    returnOnCapitalEmployedTTM FLOAT NOT NULL,
    returnOnEquityTTM FLOAT NOT NULL,
    returnOnTangibleAssetsTTM FLOAT NOT NULL,
    revenuePerShareTTM FLOAT NOT NULL,
    roeTTM FLOAT NOT NULL,
    roicTTM FLOAT NOT NULL,
    salesGeneralAndAdministrativeToRevenueTTM FLOAT NOT NULL,
    sector VARCHAR(255) NOT NULL,
    shareholdersEquityPerShareTTM FLOAT NOT NULL,
    shortTermCoverageRatiosTTM FLOAT NOT NULL,
    state VARCHAR(255) NOT NULL,
    stockBasedCompensationToRevenueTTM FLOAT NOT NULL,
    stockPrice FLOAT NOT NULL,
    symbol VARCHAR(255) NOT NULL,
    tangibleAssetValueTTM BIGINT NOT NULL,
    tangibleBookValuePerShareTTM FLOAT NOT NULL,
    totalDebtToCapitalizationTTM FLOAT NOT NULL,
    volAvg BIGINT NOT NULL,
    website VARCHAR(255) NOT NULL,
    workingCapitalTTM BIGINT NOT NULL,
    zip VARCHAR(255) NOT NULL
);


DROP TABLE IF EXISTS sec_filings;

CREATE TABLE SEC_FILINGS(
    id INT AUTO_INCREMENT PRIMARY KEY,
    symbol VARCHAR(255) NOT NULL,
    fillingDate VARCHAR(255) NOT NULL,
    acceptedDate VARCHAR(255) NOT NULL,
    cik VARCHAR(255) NOT NULL,
    type VARCHAR(255) NOT NULL,
    link VARCHAR(255) NOT NULL,
    finalLink VARCHAR(255) NOT NULL
);

ALTER TABLE SEC_FILINGS 
ADD CONSTRAINT u_links UNIQUE (link, finalLink);


CREATE TABLE balance_sheet (
    id INT AUTO_INCREMENT PRIMARY KEY,
    date DATE NOT NULL,
    symbol VARCHAR(255) NOT NULL,
    reportedCurrency VARCHAR(255) NOT NULL,
    cik VARCHAR(255) NOT NULL,
    fillingDate DATE NOT NULL,
    acceptedDate DATETIME NOT NULL,
    calendarYear INT NOT NULL,
    period VARCHAR(255) NOT NULL,
    cashAndCashEquivalents BIGINT NOT NULL,
    shortTermInvestments BIGINT NOT NULL,
    cashAndShortTermInvestments BIGINT NOT NULL,
    netReceivables BIGINT NOT NULL,
    inventory BIGINT NOT NULL,
    otherCurrentAssets BIGINT NOT NULL,
    totalCurrentAssets BIGINT NOT NULL,
    propertyPlantEquipmentNet BIGINT NOT NULL,
    goodwill BIGINT NOT NULL,
    intangibleAssets BIGINT NOT NULL,
    goodwillAndIntangibleAssets BIGINT NOT NULL,
    longTermInvestments BIGINT NOT NULL,
    taxAssets BIGINT NOT NULL,
    otherNonCurrentAssets BIGINT NOT NULL,
    totalNonCurrentAssets BIGINT NOT NULL,
    otherAssets BIGINT NOT NULL,
    totalAssets BIGINT NOT NULL,
    accountPayables BIGINT NOT NULL,
    shortTermDebt BIGINT NOT NULL,
    taxPayables BIGINT NOT NULL,
    deferredRevenue BIGINT NOT NULL,
    otherCurrentLiabilities BIGINT NOT NULL,
    totalCurrentLiabilities BIGINT NOT NULL,
    longTermDebt BIGINT NOT NULL,
    deferredRevenueNonCurrent BIGINT NOT NULL,
    deferredTaxLiabilitiesNonCurrent BIGINT NOT NULL,
    otherNonCurrentLiabilities BIGINT NOT NULL,
    totalNonCurrentLiabilities BIGINT NOT NULL,
    otherLiabilities BIGINT NOT NULL,
    capitalLeaseObligations BIGINT NOT NULL,
    totalLiabilities BIGINT NOT NULL,
    preferredStock BIGINT NOT NULL,
    commonStock BIGINT NOT NULL,
    retainedEarnings BIGINT NOT NULL,
    accumulatedOtherComprehensiveIncomeLoss BIGINT NOT NULL,
    othertotalStockholdersEquity BIGINT NOT NULL,
    totalStockholdersEquity BIGINT NOT NULL,
    totalEquity BIGINT NOT NULL,
    totalLiabilitiesAndStockholdersEquity BIGINT NOT NULL,
    minorityInterest BIGINT NOT NULL,
    totalLiabilitiesAndTotalEquity BIGINT NOT NULL,
    totalInvestments BIGINT NOT NULL,
    totalDebt BIGINT NOT NULL,
    netDebt BIGINT NOT NULL,
    link VARCHAR(255) NOT NULL UNIQUE,
    finalLink VARCHAR(255) NOT NULL UNIQUE
);


CREATE TABLE cash_flow_statement (
  id INT AUTO_INCREMENT PRIMARY KEY,
  date DATE,
  symbol VARCHAR(255),
  reportedCurrency VARCHAR(255),
  cik VARCHAR(255),
  fillingDate DATE,
  acceptedDate DATETIME,
  calendarYear VARCHAR(255),
  period VARCHAR(255),
  netIncome BIGINT,
  depreciationAndAmortization BIGINT,
  deferredIncomeTax BIGINT,
  stockBasedCompensation BIGINT,
  changeInWorkingCapital BIGINT,
  accountsReceivables BIGINT,
  inventory BIGINT,
  accountsPayables BIGINT,
  otherWorkingCapital BIGINT,
  otherNonCashItems BIGINT,
  netCashProvidedByOperatingActivities BIGINT,
  investmentsInPropertyPlantAndEquipment BIGINT,
  acquisitionsNet BIGINT,
  purchasesOfInvestments BIGINT,
  salesMaturitiesOfInvestments BIGINT,
  otherInvestingActivites BIGINT,
  netCashUsedForInvestingActivites BIGINT,
  debtRepayment BIGINT,
  commonStockIssued BIGINT,
  commonStockRepurchased BIGINT,
  dividendsPaid BIGINT,
  otherFinancingActivites BIGINT,
  netCashUsedProvidedByFinancingActivities BIGINT,
  effectOfForexChangesOnCash BIGINT,
  netChangeInCash BIGINT,
  cashAtEndOfPeriod BIGINT,
  cashAtBeginningOfPeriod BIGINT,
  operatingCashFlow BIGINT,
  capitalExpenditure BIGINT,
  freeCashFlow BIGINT,
  link VARCHAR(255) UNIQUE,
  finalLink VARCHAR(255) UNIQUE
);


CREATE TABLE income_statement(
    id INT AUTO_INCREMENT PRIMARY KEY,
    date DATE NOT NULL,
    symbol VARCHAR(255) NOT NULL,
    reportedCurrency VARCHAR(255) NOT NULL,
    cik VARCHAR(255) NOT NULL,
    fillingDate DATE NOT NULL,
    acceptedDate DATETIME NOT NULL,
    calendarYear INT NOT NULL,
    period VARCHAR(255) NOT NULL,
    revenue BIGINT NOT NULL,
    costOfRevenue BIGINT NOT NULL,
    grossProfit BIGINT NOT NULL,
    grossProfitRatio FLOAT NOT NULL,
    researchAndDevelopmentExpenses BIGINT NOT NULL,
    generalAndAdministrativeExpenses BIGINT NOT NULL,
    sellingAndMarketingExpenses BIGINT NOT NULL,
    sellingGeneralAndAdministrativeExpenses BIGINT NOT NULL,
    otherExpenses BIGINT NOT NULL,
    operatingExpenses BIGINT NOT NULL,
    costAndExpenses BIGINT NOT NULL,
    interestIncome BIGINT NOT NULL,
    interestExpense BIGINT NOT NULL,
    depreciationAndAmortization BIGINT NOT NULL,
    ebitda BIGINT NOT NULL,
    ebitdaratio FLOAT NOT NULL,
    operatingIncome BIGINT NOT NULL,
    operatingIncomeRatio FLOAT NOT NULL,
    totalOtherIncomeExpensesNet BIGINT NOT NULL,
    incomeBeforeTax BIGINT NOT NULL,
    incomeBeforeTaxRatio FLOAT NOT NULL,
    incomeTaxExpense BIGINT NOT NULL,
    netIncome BIGINT NOT NULL,
    netIncomeRatio FLOAT NOT NULL,
    eps FLOAT NOT NULL,
    epsdiluted FLOAT NOT NULL,
    weightedAverageShsOut BIGINT NOT NULL,
    weightedAverageShsOutDil BIGINT NOT NULL,
    link VARCHAR(255) NOT NULL UNIQUE,
    finalLink VARCHAR(255) NOT NULL UNIQUE
);


DROP TABLE IF EXISTS users;

CREATE TABLE users(
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    pwd VARCHAR(255) NOT NULL,
    api_key VARCHAR(255) NOT NULL,
    is_admin BOOLEAN NOT NULL DEFAULT false,
    email VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255) NOT NULL
);
    
INSERT INTO `users`(username, pwd, api_key, is_admin, email, full_name) VALUES 
    ('admin', MD5('admin'), 'not applicable', '1', 'admin@fmp.com', 'admin'),
    ('bela', MD5('pwd'), '07f36a5b1c35e69f0046d0e6a3ab12d6', '0', 'bela@fmp.com', 'Hello my name is Bela'),
    ('jenna', MD5('pwd'), '2b1c52c776217c377aa030db56150115', '0', 'jenna@fmp.com', 'Jennas in the house');